!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.SchemaFormCore=t():e.SchemaFormCore=t()}("undefined"!=typeof self?self:this,function(){return function(e){function t(a){if(r[a])return r[a].exports;var n=r[a]={i:a,l:!1,exports:{}},o=!0;try{e[a].call(n.exports,n,n.exports,t),o=!1}finally{o&&delete r[a]}return n.l=!0,n.exports}var r={};return t.m=e,t.c=r,t.d=function(e,r,a){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:a})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=3)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(1),n=/#$/g,o=function(){function e(e,t,r){void 0===r&&(r=""),this.ajv=e,this.$id=r,this.mergeSchema={},r||this.initSchema(e,t),this.compileSchema(t,r||t.$ref||"")}return e.prototype.initSchema=function(e,t){var r=t.$id;if(!r&&!t.$ref)throw new Error("id is required by fx-schema-form-core.");if(!e.validateSchema(t))throw e.errors;return r&&!e.getSchema(r)&&e.addSchema(t),t},e.prototype.compileSchema=function(e,t){if(e=a.schemaTypeFactory.get("undefined")(e,t||e.$id+"#",this.ajv),this.mergeSchema=e,e.type&&!e.$ref){if(e.type.constructor!==String)throw new Error("schema type["+e.type+"] can only be string.");var r=e.type.toString();a.schemaTypeFactory.has(r)&&(this.mergeSchema=a.schemaTypeFactory.get(r)(e,t||e.$id+"#",this.ajv))}},e.getDataKeys=function(e,t){return void 0===t&&(t=!1),e.split("/").map(function(e,r){return 0===r&&n.test(e)?(n.lastIndex=0,t?e.replace(n,""):null):"properties"===e?null:"items"===e?"-":e}).filter(function(e){return null!==e})},e.getSchemaId=function(e){var t=e.split("/");if(!t.length)throw new Error(e+" not a valid schemaPath.");return t[0].replace(n,"")},e}();t.default=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(2);t.schemaFieldFactory=new a.BaseFactory,t.schemaKeyWordFactory=new a.BaseFactory,t.schemaTypeFactory=new a.BaseFactory,t.schemaKeysFactory=new a.BaseFactory,t.convertKeys=function(e,r){return t.schemaKeyWordFactory.forEach(function(t,a){e=a(e,r)}),e}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(){this.instances={},this.protectedInstances={}}return e.prototype.add=function(e,t,r){if(void 0===r&&(r=!1),!this.protectedInstances.hasOwnProperty(e)&&(r||!this.has(e)))return this.instances[e]=t,!0},e.prototype.has=function(e){return this.instances.hasOwnProperty(e)},e.prototype.get=function(e){if(this.has(e))return this.instances[e];throw new Error("name=["+e+"]not exist")},e.prototype.lock=function(e){this.has(e)&&(this.protectedInstances[e]=!0)},e.prototype.unLock=function(e){this.has(e)&&delete this.protectedInstances[e]},e.prototype.forEach=function(e){if(e)for(var t in this.instances)if(this.instances.hasOwnProperty(t)){var r=this.instances[t];if(!1===e(t,r))break}},e.prototype.clear=function(){this.instances={},this.protectedInstances={}},e}();t.BaseFactory=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(4),n=r(8),o=r(2);t.BaseFactory=o.BaseFactory;var c=r(1);t.schemaFieldFactory=c.schemaFieldFactory,t.schemaKeyWordFactory=c.schemaKeyWordFactory,t.schemaTypeFactory=c.schemaTypeFactory,t.schemaKeysFactory=c.schemaKeysFactory;var i=r(0);t.ResolveLib=i.default;var s=r(12);t.MergeLib=s.default,c.schemaKeyWordFactory.add("ref",a.ref),c.schemaKeyWordFactory.add("oneof",a.oneof),c.schemaKeyWordFactory.add("anyof",a.anyof),c.schemaTypeFactory.add("array",n.array),c.schemaTypeFactory.add("string",n.none),c.schemaTypeFactory.add("undefined",n.none),c.schemaTypeFactory.add("number",n.none),c.schemaTypeFactory.add("null",n.none),c.schemaTypeFactory.add("any",n.none),c.schemaTypeFactory.add("integer",n.none),c.schemaTypeFactory.add("boolean",n.none),c.schemaTypeFactory.add("object",n.object)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(5);t.ref=a.default;var n=r(6);t.oneof=n.default;var o=r(7);t.anyof=o.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(0);t.default=function(e,t){if(e&&e.$ref){var r=t.getSchema(e.$ref);if(r&&r.schema){var n=Object.assign({},r.schema);return n.$ref=e.$ref,delete n.$id,Object.assign(n,{refKeys:a.default.getDataKeys(e.$ref)}),n}throw new Error("${schema.$ref} not exist.")}return e}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(0);t.default=function(e,t){if(!e)return e;var r=e.oneOf;return r&&r.constructor===Array&&(e.oneOf=r.map(function(e){return new a.default(t,e).mergeSchema})),e}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(0);t.default=function(e,t){if(!e)return e;var r=e.anyOf;return r&&r.constructor===Array&&(e.oneOf=r.map(function(e){return new a.default(t,e).mergeSchema})),e}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(9);t.array=a.default;var n=r(10);t.object=n.default;var o=r(11);t.none=o.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(0);t.default=function(e,t,r){if(e.items){var n=new a.default(r,e.items,[t,"items"].join("/")),o=a.default.getDataKeys([t,"items"].join("/"));Object.assign(n.mergeSchema,{keys:o})}return e}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(0);t.default=function(e,t,r){return e.properties&&!e.$ref&&Object.keys(e.properties).forEach(function(n){if(["properties","items"].indexOf(n)>=0)throw new Error(n+"为保留关键字.");if(e.properties&&e.properties[n]){var o=new a.default(r,e.properties[n],[t,"properties",n].join("/")),c=a.default.getDataKeys([t,"properties",n].join("/"));Object.assign(o.mergeSchema,{keys:c})}}),e}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(1),n=r(0);t.default=function(e,t,r){var o=a.convertKeys(e,r),c=n.default.getDataKeys(t),i=n.default.getSchemaId(t);return a.schemaFieldFactory.has(t)?(o&&(o.resolve=!0),o||e):(a.schemaFieldFactory.add(t,Object.assign({},o||e,{keys:c,schemaPath:t})),a.schemaKeysFactory.add([i].concat(c).join("/"),t),o||e)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(13),n=r(1),o=r(0),c=function(){function e(e,t,r,c){if(void 0===r&&(r=null),void 0===c&&(c=["*"]),this.schemaPath=t,this.parent=r,this.uiSchemas=c,!e.validate(a.uiSchemaSchema,c))throw e.errors;var i=o.default.getDataKeys(t,!0).join("/");if(!n.schemaKeysFactory.has(i))throw new Error(i+" not exist or "+i+" did not resolve yet.");this.curSchema=n.schemaFieldFactory.get(n.schemaKeysFactory.get(i)),this.curSchema.$id&&(this.curSchema.$ref=this.curSchema.$id,this.curSchema.$id=void 0),this.mergeUiSchemaList=this.mergeUiSchema()}return e.prototype.getParentSchemaKeys=function(){return this.parent&&this.parent.keys?this.parent.keys:[]},e.prototype.getUiSchemaKeyRecursion=function(e,t){for(;e.length;){var r=e.shift()||"",a=r?t.concat([r]):t,c=a.join("/").replace(/\/$/,"");if(!n.schemaKeysFactory.has(c))throw console.log(n.schemaKeysFactory),new Error(a.join("/")+" did not found. do you forget to resolve schema first.");var i=n.schemaFieldFactory.get(n.schemaKeysFactory.get(c));t=i.$ref?o.default.getDataKeys(i.$ref,!0):a}return t.join("/")},e.prototype.getCurrentSchemaKey=function(e){var t=o.default.getSchemaId(this.schemaPath),r=e.key.split("/");return this.parent&&o.default.getSchemaId(this.parent.key)===t?this.getUiSchemaKeyRecursion(r,this.parent.key.split("/")):this.getUiSchemaKeyRecursion(r,[t])},e.prototype.initUiSchema=function(e){var t,r=this.getParentSchemaKeys();return t=r.concat(e.key?e.key.split("/"):[]),Object.assign({},e,{key:this.getCurrentSchemaKey(e),keys:t})},e.prototype.mergeUiSchemaToArray=function(e){if(!n.schemaKeysFactory.has(e.key))throw new Error(e.key+" did not found. do you forget to resolve schema first.");var t=n.schemaKeysFactory.get(e.key),r=n.schemaFieldFactory.get(t);return Object.assign({},r,e)},e.prototype.mergeUiSchema=function(){var e=this,t=this.uiSchemas.indexOf("*"),r=[],a=[],n=this.curSchema,c=["object","array"];if(this.uiSchemas.lastIndexOf("*")!==t)throw new Error("uiSchema can only has one *.");if(t<0)return this.uiSchemas.slice(t+1).map(function(t){var a=e.initUiSchema(t.constructor===String?{key:t}:t);r.push(e.mergeUiSchemaToArray(a))}),r;if(this.uiSchemas.slice(0,t).forEach(function(t){var a=e.initUiSchema(t.constructor===String?{key:t}:t);r.push(e.mergeUiSchemaToArray(a))}),this.uiSchemas.slice(t+1).forEach(function(t){var r=e.initUiSchema(t.constructor===String?{key:t}:t);a.push(e.mergeUiSchemaToArray(r))}),n.type===c[0]&&n.properties&&Object.keys(n.properties).forEach(function(t){var n=e.initUiSchema({key:t});r.concat(a).filter(function(e){return e.key===n.key}).length||(n=e.mergeUiSchemaToArray(n),r.push(n))}),n.type===c[1]&&n.items){var i=this.initUiSchema({key:o.default.getDataKeys(n.schemaPath||"").join("/")});r.concat(a).filter(function(e){return e.key===i.key}).length||(i=this.mergeUiSchemaToArray(i),r.push(i))}if(c.indexOf(n.type)<0){var s=this.initUiSchema({key:o.default.getDataKeys(n.schemaPath||"",!1).join("/")});r.concat(a).filter(function(e){return e.key===s.key}).length||(s=this.mergeUiSchemaToArray(s),r.push(s))}return r.concat(a)},e}();t.default=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(14);t.uiSchemaSchema={type:"array",items:{anyOf:[{type:"string",minLength:a.a},{type:"object",required:["key"],properties:{key:{type:"string"}}}]}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.a=1}])});