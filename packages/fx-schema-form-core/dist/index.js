!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.SchemaFormCore=t():e.SchemaFormCore=t()}("undefined"!=typeof self?self:this,function(){return function(e){function t(a){if(r[a])return r[a].exports;var o=r[a]={i:a,l:!1,exports:{}},n=!0;try{e[a].call(o.exports,o,o.exports,t),n=!1}finally{n&&delete r[a]}return o.l=!0,o.exports}var r={};return t.m=e,t.c=r,t.d=function(e,r,a){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:a})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=3)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(1),o=/#$/g,n=function(){function e(e,t,r){void 0===r&&(r=""),this.ajv=e,this.$id=r,this.mergeSchema={},r||this.initSchema(e,t),this.compileSchema(t,r||t.$ref||"")}return e.prototype.initSchema=function(e,t){var r=t.$id;if(!r&&!t.$ref)throw new Error("id is required by fx-schema-form-core.");if(!e.validateSchema(t))throw e.errors;return r&&!e.getSchema(r)&&e.addSchema(t),t},e.prototype.compileSchema=function(e,t){if(e=a.schemaTypeFactory.get("undefined")(e,t||e.$id+"#",this.ajv),this.mergeSchema=e,e.type){if(e.type.constructor!==String)throw new Error("schema type["+e.type+"] can only be string.");var r=e.type.toString();a.schemaTypeFactory.has(r)&&(this.mergeSchema=a.schemaTypeFactory.get(r)(e,t||e.$id+"#",this.ajv))}},e.getDataKeys=function(e,t){return void 0===t&&(t=!1),e.split("/").map(function(e,r){return 0===r&&o.test(e)?(o.lastIndex=0,t?e.replace(o,""):null):"properties"===e?null:"items"===e?"-":e}).filter(function(e){return null!==e})},e.getSchemaId=function(e){var t=e.split("/");if(!t.length)throw new Error(e+" not a valid schemaPath.");return t[0].replace(o,"")},e}();t.default=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(2);t.schemaFieldFactory=new a.BaseFactory,t.schemaKeyWordFactory=new a.BaseFactory,t.schemaTypeFactory=new a.BaseFactory,t.schemaKeysFactory=new a.BaseFactory,t.convertKeys=function(e,r){return t.schemaKeyWordFactory.forEach(function(t,a){e=a(e,r)}),e}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(){this.instances={},this.protectedInstances={}}return e.prototype.add=function(e,t,r){return void 0===r&&(r=!1),this.protectedInstances.hasOwnProperty(e)?console.error("name=【"+e+"】has locked!"):!r&&this.has(e)?console.error("【"+e+"】exist!"):(this.instances[e]=t,!0)},e.prototype.has=function(e){return this.instances.hasOwnProperty(e)},e.prototype.get=function(e){if(this.has(e))return this.instances[e];throw new Error("name=["+e+"]not exist")},e.prototype.lock=function(e){this.has(e)&&(this.protectedInstances[e]=!0)},e.prototype.unLock=function(e){this.has(e)&&delete this.protectedInstances[e]},e.prototype.forEach=function(e){if(e)for(var t in this.instances)if(this.instances.hasOwnProperty(t)){var r=this.instances[t];if(!1===e(t,r))break}},e.prototype.clear=function(){this.instances={},this.protectedInstances={}},e}();t.BaseFactory=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(4),o=r(7),n=r(2);t.BaseFactory=n.BaseFactory;var c=r(1);t.schemaFieldFactory=c.schemaFieldFactory,t.schemaKeyWordFactory=c.schemaKeyWordFactory,t.schemaTypeFactory=c.schemaTypeFactory,t.schemaKeysFactory=c.schemaKeysFactory;var i=r(0);t.ResolveLib=i.default;var s=r(11);t.MergeLib=s.default,c.schemaKeyWordFactory.add("ref",a.ref),c.schemaKeyWordFactory.add("oneof",a.oneof),c.schemaTypeFactory.add("array",o.array),c.schemaTypeFactory.add("string",o.none),c.schemaTypeFactory.add("undefined",o.none),c.schemaTypeFactory.add("number",o.none),c.schemaTypeFactory.add("null",o.none),c.schemaTypeFactory.add("any",o.none),c.schemaTypeFactory.add("integer",o.none),c.schemaTypeFactory.add("boolean",o.none),c.schemaTypeFactory.add("object",o.object)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(5);t.ref=a.default;var o=r(6);t.oneof=o.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(0);t.default=function(e,t){if(e&&e.$ref){var r=t.getSchema(e.$ref);if(r&&r.schema){var o=r.schema;return o.$ref=e.$ref,Object.assign(o,{refKeys:a.default.getDataKeys(e.$ref)}),o}throw new Error("${schema.$ref} not exist.")}return e}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(0);t.default=function(e,t){if(!e)return e;var r=e.oneOf;return r&&r.constructor===Array&&(e.oneOf=r.map(function(e){return new a.default(t,e).mergeSchema})),e}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(8);t.array=a.default;var o=r(9);t.object=o.default;var n=r(10);t.none=n.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(0);t.default=function(e,t,r){if(e.items){var o=new a.default(r,e.items,[t,"items"].join("/")),n=a.default.getDataKeys([t,"items"].join("/"));Object.assign(o.mergeSchema,{keys:n})}return e}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(0);t.default=function(e,t,r){return e.properties&&Object.keys(e.properties).forEach(function(o){if(["properties","items"].indexOf(o)>=0)throw new Error(o+"为保留关键字.");if(e.properties&&e.properties[o]){var n=new a.default(r,e.properties[o],[t,"properties",o].join("/")),c=a.default.getDataKeys([t,"properties",o].join("/"));Object.assign(n.mergeSchema,{keys:c})}}),e}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(1),o=r(0);t.default=function(e,t,r){var n=a.convertKeys(e,r),c=o.default.getDataKeys(t),i=o.default.getSchemaId(t);return a.schemaFieldFactory.has(t)?n||e:(a.schemaFieldFactory.add(t,Object.assign({},n||e,{keys:c,schemaPath:t})),a.schemaKeysFactory.add([i].concat(c).join("/"),t),e)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(12),o=r(1),n=r(0),c=function(){function e(e,t,r,c){if(void 0===r&&(r=null),void 0===c&&(c=["*"]),this.schemaPath=t,this.parent=r,this.uiSchemas=c,!e.validate(a.uiSchemaSchema,c))throw e.errors;var i=n.default.getDataKeys(t,!0).join("/");if(!o.schemaKeysFactory.has(i))throw new Error(i+" not exist or "+i+" did not resolve yet.");this.curSchema=o.schemaFieldFactory.get(o.schemaKeysFactory.get(i)),this.mergeUiSchemaList=this.mergeUiSchema()}return e.prototype.getParentSchemaKeys=function(){return this.parent&&this.parent.keys?this.parent.keys:[]},e.prototype.getUiSchemaKeyRecursion=function(e,t){for(;e.length;){var r=e.shift()||"",a=t.concat([r]);if(!o.schemaKeysFactory.has(a.join("/")))throw new Error(a.join("/")+" did not found. do you forget to resolve schema first.");var c=o.schemaFieldFactory.get(o.schemaKeysFactory.get(a.join("/")));t=c.$ref?n.default.getDataKeys(c.$ref,!0):a}return t.join("/")},e.prototype.getCurrentSchemaKey=function(e){var t=n.default.getSchemaId(this.schemaPath),r=e.key.split("/");return this.parent?this.getUiSchemaKeyRecursion(r,this.parent.key.split("/")):this.getUiSchemaKeyRecursion(r,[t])},e.prototype.initUiSchema=function(e){var t,r=this.getParentSchemaKeys();return t=r.concat(e.key.split("/")),Object.assign({},e,{key:this.getCurrentSchemaKey(e),keys:t})},e.prototype.mergeUiSchemaToArray=function(e){if(!o.schemaKeysFactory.has(e.key))throw new Error(e.key+" did not found. do you forget to resolve schema first.");var t=o.schemaKeysFactory.get(e.key),r=o.schemaFieldFactory.get(t);return Object.assign({},r,e)},e.prototype.mergeUiSchema=function(){var e=this,t=this.uiSchemas.indexOf("*"),r=[],a=[];if(this.uiSchemas.lastIndexOf("*")!==t)throw new Error("uiSchema can only has one *.");if(t<0)return this.uiSchemas.slice(t+1).map(function(t){var a=e.initUiSchema(t.constructor===String?{key:t}:t);r.push(e.mergeUiSchemaToArray(a))}),r;if(this.uiSchemas.slice(0,t).forEach(function(t){var a=e.initUiSchema(t.constructor===String?{key:t}:t);r.push(e.mergeUiSchemaToArray(a))}),this.uiSchemas.slice(t+1).forEach(function(t){var r=e.initUiSchema(t.constructor===String?{key:t}:t);a.push(e.mergeUiSchemaToArray(r))}),"object"===this.curSchema.type&&this.curSchema.properties&&Object.keys(this.curSchema.properties).forEach(function(t){var o=e.initUiSchema({key:t});r.concat(a).filter(function(e){return e.key===o.key}).length||(o=e.mergeUiSchemaToArray(o),r.push(o))}),"array"===this.curSchema.type&&this.curSchema.items){var o=this.initUiSchema({key:n.default.getDataKeys(this.curSchema.schemaPath||"").join("/")});r.concat(a).filter(function(e){return e.key===o.key}).length||(o=this.mergeUiSchemaToArray(o),r.push(o))}return r.concat(a)},e}();t.default=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(13);t.uiSchemaSchema={type:"array",items:{anyOf:[{type:"string",minLength:a.a},{type:"object",required:["key"],properties:{key:{type:"string"}}}]}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.a=1}])});