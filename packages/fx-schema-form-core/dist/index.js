!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.FxSchemaFormCore=t():e.FxSchemaFormCore=t()}(this,function(){return function(e){function t(a){if(r[a])return r[a].exports;var o=r[a]={exports:{},id:a,loaded:!1};return e[a].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var r={};return t.m=e,t.c=r,t.p="/",t(0)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(4),o=r(10),n=r(3);t.BaseFactory=n.BaseFactory;var i=r(2);t.schemaFieldFactory=i.schemaFieldFactory,t.schemaKeyWordFactory=i.schemaKeyWordFactory,t.schemaTypeFactory=i.schemaTypeFactory,t.schemaKeysFactory=i.schemaKeysFactory;var c=r(1);t.ResolveLib=c.ResolveLib;var s=r(7);t.MergeLib=s.MergeLib,i.schemaKeyWordFactory.add("ref",a.ref),i.schemaKeyWordFactory.add("oneof",a.oneof),i.schemaTypeFactory.add("array",o.array),i.schemaTypeFactory.add("string",o.none),i.schemaTypeFactory.add("undefined",o.none),i.schemaTypeFactory.add("number",o.none),i.schemaTypeFactory.add("null",o.none),i.schemaTypeFactory.add("any",o.none),i.schemaTypeFactory.add("integer",o.none),i.schemaTypeFactory.add("boolean",o.none),i.schemaTypeFactory.add("object",o.object)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(2),o=/#$/g,n=function(){function e(e,t,r){void 0===r&&(r=""),this.ajv=e,this.$id=r,r||this.initSchema(e,t),this.compileSchema(t,r||t.$ref)}return e.prototype.initSchema=function(e,t){var r=t.$id;if(!r&&!t.$ref)throw new Error("id is required by fx-schema-form-core.");if(!e.validateSchema(t))throw e.errors;return r&&!e.getSchema(r)&&e.addSchema(t),t},e.prototype.compileSchema=function(e,t){if(e=a.schemaTypeFactory.get("undefined")(e,t||e.$id+"#",this.ajv),this.mergeSchema=e,e.type){if(e.type.constructor!==String)throw new Error("schema type["+e.type+"] can only be string.");var r=e.type.toString();a.schemaTypeFactory.has(r)&&(this.mergeSchema=a.schemaTypeFactory.get(r)(e,t||e.$id+"#",this.ajv))}},e.getDataKeys=function(e,t){void 0===t&&(t=!1);var r=e.split("/").map(function(e,r){return 0===r&&o.test(e)?(o.lastIndex=0,t?e.replace(o,""):null):"properties"===e?null:"items"===e?"-":e});return r.filter(function(e){return!!e})},e.getSchemaId=function(e){var t=e.split("/");if(!t.length)throw new Error(e+" not a valid schemaPath.");return t[0].replace(o,"")},e}();t.ResolveLib=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(3);t.schemaFieldFactory=new a.BaseFactory,t.schemaKeyWordFactory=new a.BaseFactory,t.schemaTypeFactory=new a.BaseFactory,t.schemaKeysFactory=new a.BaseFactory,t.convertKeys=function(e,r){return t.schemaKeyWordFactory.forEach(function(t,a){e=a(e,r)}),e}},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this.instances={},this.protectedInstances={}}return e.prototype.add=function(e,t,r){return void 0===r&&(r=!1),this.protectedInstances.hasOwnProperty(e)?console.error("name=\u3010"+e+"\u3011has locked!"):!r&&this.has(e)?console.error("\u3010"+e+"\u3011exist!"):(this.instances[e]=t,!0)},e.prototype.has=function(e){return this.instances.hasOwnProperty(e)},e.prototype.get=function(e){if(this.has(e))return this.instances[e];throw new Error("name=["+e+"]not exist")},e.prototype.lock=function(e){this.has(e)&&(this.protectedInstances[e]=!0)},e.prototype.unLock=function(e){this.has(e)&&delete this.protectedInstances[e]},e.prototype.forEach=function(e){if(e)for(var t in this.instances)if(this.instances.hasOwnProperty(t)){var r=this.instances[t];if(e(t,r)===!1)break}},e.prototype.clear=function(){this.instances={},this.protectedInstances={}},e}();t.BaseFactory=r},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(6);t.ref=a.default;var o=r(5);t.oneof=o.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(1);t.default=function(e,t){if(!e)return e;var r=e.oneOf;return r&&r.constructor===Array&&(e.oneOf=r.map(function(e){var r=new a.ResolveLib(t,e);return r.mergeSchema})),e}},function(e,t,r){"use strict";var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e};Object.defineProperty(t,"__esModule",{value:!0});var o=r(1);t.default=function(e,t){if(e&&e.$ref){var r=t.getSchema(e.$ref);if(r&&r.schema){var n=r.schema;return n.$ref=e.$ref,a(n,{refKeys:o.ResolveLib.getDataKeys(e.$ref)}),n}throw new Error("${schema.$ref} not exist.")}return e}},function(e,t,r){"use strict";var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e};Object.defineProperty(t,"__esModule",{value:!0});var o=r(8),n=r(2),i=r(1),c=function(){function e(e,t,r,a){if(this.schemaPath=t,this.parent=r,this.uiSchemas=a,!e.validate(o.uiSchemaSchema,a))throw e.errors;var c=i.ResolveLib.getDataKeys(t,!0).join("/");if(!n.schemaKeysFactory.has(c))throw new Error(c+" not exist or "+c+" did not resolve yet.");this.curSchema=n.schemaFieldFactory.get(n.schemaKeysFactory.get(c)),this.mergeUiSchemaList=this.mergeUiSchema()}return e.prototype.getParentSchemaKeys=function(){return this.parent&&this.parent.keys?this.parent.keys:[]},e.prototype.getUiSchemaKeyRecursion=function(e,t){for(;e.length;){var r=e.shift(),a=t.concat([r]);if(!n.schemaKeysFactory.has(a.join("/")))throw new Error(a.join("/")+" did not found. do you forget to resolve schema first.");var o=n.schemaFieldFactory.get(n.schemaKeysFactory.get(a.join("/")));t=o.$ref?i.ResolveLib.getDataKeys(o.$ref,!0):a}return t.join("/")},e.prototype.getCurrentSchemaKey=function(e){var t=i.ResolveLib.getSchemaId(this.schemaPath),r=e.key.split("/");return this.parent?this.getUiSchemaKeyRecursion(r,this.parent.key.split("/")):this.getUiSchemaKeyRecursion(r,[t])},e.prototype.initUiSchema=function(e){var t,r=this.getParentSchemaKeys();return t=r.concat(e.key.split("/")),a({},e,{key:this.getCurrentSchemaKey(e),keys:t})},e.prototype.mergeUiSchemaToArray=function(e){if(!n.schemaKeysFactory.has(e.key))throw new Error(e.key+" did not found. do you forget to resolve schema first.");var t=n.schemaKeysFactory.get(e.key),r=n.schemaFieldFactory.get(t);return a({},r,e)},e.prototype.mergeUiSchema=function(){var e=this,t=this.uiSchemas.indexOf("*"),r=[],a=[];if(this.uiSchemas.lastIndexOf("*")!==t)throw new Error("uiSchema can only has one *.");if(t<0)return this.uiSchemas.slice(t+1).map(function(t){var a=e.initUiSchema(t.constructor===String?{key:t}:t);r.push(e.mergeUiSchemaToArray(a))}),r;if(this.uiSchemas.slice(0,t).forEach(function(t){var a=e.initUiSchema(t.constructor===String?{key:t}:t);r.push(e.mergeUiSchemaToArray(a))}),this.uiSchemas.slice(t+1).forEach(function(t){var r=e.initUiSchema(t.constructor===String?{key:t}:t);a.push(e.mergeUiSchemaToArray(r))}),"object"===this.curSchema.type&&this.curSchema.properties&&Object.keys(this.curSchema.properties).forEach(function(t){var o=e.initUiSchema({key:t});r.concat(a).filter(function(e){return e.key===o.key}).length||(o=e.mergeUiSchemaToArray(o),r.push(o))}),"array"===this.curSchema.type&&this.curSchema.items){var o=this.initUiSchema({key:i.ResolveLib.getDataKeys(this.curSchema.schemaPath).join("/")});r.concat(a).filter(function(e){return e.key===o.key}).length||(o=this.mergeUiSchemaToArray(o),r.push(o))}return r.concat(a)},e}();t.MergeLib=c},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.uiSchemaSchema={type:"array",items:{anyOf:[{type:"string",minLength:1},{additionalProperties:!0,type:"object",required:["key"],properties:{key:{type:"string"}}}]}}},function(e,t,r){"use strict";var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e};Object.defineProperty(t,"__esModule",{value:!0});var o=r(1);t.default=function(e,t,r){if(e.items){var n=new o.ResolveLib(r,e.items,[t,"items"].join("/")),i=o.ResolveLib.getDataKeys([t,"items"].join("/"));a(n.mergeSchema,{keys:i})}return e}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(9);t.array=a.default;var o=r(12);t.object=o.default;var n=r(11);t.none=n.default},function(e,t,r){"use strict";var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e};Object.defineProperty(t,"__esModule",{value:!0});var o=r(2),n=r(1);t.default=function(e,t,r){var i=o.convertKeys(e,r),c=n.ResolveLib.getDataKeys(t),s=n.ResolveLib.getSchemaId(t);return o.schemaFieldFactory.has(t)?i||e:(o.schemaFieldFactory.add(t,a({},i||e,{keys:c,schemaPath:t})),o.schemaKeysFactory.add([s].concat(c).join("/"),t),e)}},function(e,t,r){"use strict";var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e};Object.defineProperty(t,"__esModule",{value:!0});var o=r(1);t.default=function(e,t,r){return e.properties&&Object.keys(e.properties).forEach(function(n){if(["properties","items"].indexOf(n)>=0)throw new Error(n+"\u4e3a\u4fdd\u7559\u5173\u952e\u5b57.");var i=new o.ResolveLib(r,e.properties[n],[t,"properties",n].join("/")),c=o.ResolveLib.getDataKeys([t,"properties",n].join("/"));a(i.mergeSchema,{keys:c})}),e}}])});