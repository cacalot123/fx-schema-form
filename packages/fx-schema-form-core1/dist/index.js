!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports["fx-schema-form-core"]=t():e["fx-schema-form-core"]=t()}(this,function(){return function(e){function t(o){if(r[o])return r[o].exports;var a=r[o]={exports:{},id:o,loaded:!1};return e[o].call(a.exports,a,a.exports,t),a.loaded=!0,a.exports}var r={};return t.m=e,t.c=r,t.p="/",t(0)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.schemaTypeFactory=t.schemaKeyWordFactory=t.schemaFieldFactory=t.schemaKeysFactory=t.BaseFactory=t.MergeLib=t.ResolveLib=void 0;var o=r(1);Object.defineProperty(t,"ResolveLib",{enumerable:!0,get:function(){return o.ResolveLib}});var a=r(7);Object.defineProperty(t,"MergeLib",{enumerable:!0,get:function(){return a.MergeLib}});var n=r(4),c=r(10),i=r(3),s=r(2);s.schemaKeyWordFactory.add("ref",n.ref),s.schemaKeyWordFactory.add("oneof",n.oneof),s.schemaTypeFactory.add("array",c.array),s.schemaTypeFactory.add("string",c.none),s.schemaTypeFactory.add("undefined",c.none),s.schemaTypeFactory.add("number",c.none),s.schemaTypeFactory.add("null",c.none),s.schemaTypeFactory.add("any",c.none),s.schemaTypeFactory.add("integer",c.none),s.schemaTypeFactory.add("boolean",c.none),s.schemaTypeFactory.add("object",c.object),t.BaseFactory=i.BaseFactory,t.schemaKeysFactory=s.schemaKeysFactory,t.schemaFieldFactory=s.schemaFieldFactory,t.schemaKeyWordFactory=s.schemaKeyWordFactory,t.schemaTypeFactory=s.schemaTypeFactory},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ResolveLib=void 0;var o=r(2),a=/#$/g,n=function(){function e(e,t,r){void 0===r&&(r=""),this.ajv=e,this.schema=t,this.$id=r,r||this.initSchema(e,t),this.compileSchema(t,r||t.$ref)}return e.prototype.initSchema=function(e,t){var r=t.$id;if(!r&&!t.$ref)throw new Error("id is required by fx-schema-form-core.");if(!e.validateSchema(t))throw e.errors;return r&&!e.getSchema(r)&&e.addSchema(t),t},e.prototype.compileSchema=function(e,t){if(e=o.schemaTypeFactory.get("undefined")(e,t||e.$id+"#",this.ajv),this.mergeSchema=e,e.type){if(e.type.constructor!==String)throw new Error("schema type["+e.type+"] can only be string.");var r=e.type.toString();o.schemaTypeFactory.has(r)&&(this.mergeSchema=o.schemaTypeFactory.get(r)(e,t||e.$id+"#",this.ajv))}},e.getDataKeys=function(e,t){void 0===t&&(t=!1);var r=e.split("/").map(function(e,r){return 0===r&&a.test(e)?(a.lastIndex=0,t?e.replace(a,""):null):"properties"===e?null:"items"===e?"-":e});return r.filter(function(e){return!!e})},e.getSchemaId=function(e){var t=e.split("/");if(!t.length)throw new Error(e+" not a valid schemaPath.");return t[0].replace(a,"")},e}();t.ResolveLib=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.convertKeys=t.schemaKeysFactory=t.schemaTypeFactory=t.schemaKeyWordFactory=t.schemaFieldFactory=void 0;var o=r(3),a=(t.schemaFieldFactory=new o.BaseFactory,t.schemaKeyWordFactory=new o.BaseFactory);t.schemaTypeFactory=new o.BaseFactory,t.schemaKeysFactory=new o.BaseFactory,t.convertKeys=function(e,t){return a.forEach(function(r,o){e=o(e,t)}),e}},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this.instances={},this.protectedInstances={}}return e.prototype.add=function(e,t,r){return void 0===r&&(r=!1),this.protectedInstances.hasOwnProperty(e)?console.error("name=\u3010"+e+"\u3011has locked!"):!r&&this.has(e)?console.error("\u3010"+e+"\u3011exist!"):(this.instances[e]=t,!0)},e.prototype.has=function(e){return this.instances.hasOwnProperty(e)},e.prototype.get=function(e){if(this.has(e))return this.instances[e];throw new Error("name=["+e+"]not exist")},e.prototype.lock=function(e){this.has(e)&&(this.protectedInstances[e]=!0)},e.prototype.unLock=function(e){this.has(e)&&delete this.protectedInstances[e]},e.prototype.forEach=function(e){if(e)for(var t in this.instances)if(this.instances.hasOwnProperty(t)){var r=this.instances[t];if(e(t,r)===!1)break}},e.prototype.clear=function(){this.instances={},this.protectedInstances={}},e}();t.BaseFactory=r},function(e,t,r){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=r(6);Object.defineProperty(t,"ref",{enumerable:!0,get:function(){return o(a).default}});var n=r(5);Object.defineProperty(t,"oneof",{enumerable:!0,get:function(){return o(n).default}})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return e&&e.oneOf&&e.oneOf.constructor===Array&&(e.oneOf=e.oneOf.map(function(e){var r=new o.ResolveLib(t,e);return r.mergeSchema})),e};var o=r(1);e.exports=t.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e};t.default=function(e,t){if(e&&e.$ref){var r=t.getSchema(e.$ref);if(r&&r.schema){var n=r.schema;return n.$ref=e.$ref,o(n,{refKeys:a.ResolveLib.getDataKeys(e.$ref)}),n}throw new Error("${schema.$ref} not exist.")}return e};var a=r(1);e.exports=t.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MergeLib=void 0;var o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e},a=r(8),n=r(2),c=r(1),i=function(){function e(e,t,r,o){if(this.ajv=e,this.schemaPath=t,this.parent=r,this.uiSchemas=o,!e.validate(a.uiSchemaSchema,o))throw e.errors;var i=c.ResolveLib.getDataKeys(t,!0).join("/");if(!n.schemaKeysFactory.has(i))throw new Error(i+" not exist or "+i+" did not resolve yet.");this.curSchema=n.schemaFieldFactory.get(n.schemaKeysFactory.get(i)),this.mergeUiSchemaList=this.mergeUiSchema()}return e.prototype.getParentSchemaKeys=function(){return this.parent&&this.parent.keys?this.parent.keys:[]},e.prototype.getUiSchemaKeyRecursion=function(e,t){for(;e.length;){var r=e.shift(),o=t.concat([r]);if(console.log(r),!n.schemaKeysFactory.has(o.join("/")))throw new Error(o.join("/")+" did not found. do you forget to resolve schema first.");var a=n.schemaFieldFactory.get(n.schemaKeysFactory.get(o.join("/")));t=a.$ref?c.ResolveLib.getDataKeys(a.$ref,!0):o}return t.join("/")},e.prototype.getCurrentSchemaKey=function(e){var t=c.ResolveLib.getSchemaId(this.schemaPath),r=e.key.split("/");return this.parent?this.getUiSchemaKeyRecursion(r,this.parent.key.split("/")):this.getUiSchemaKeyRecursion(r,[t])},e.prototype.initUiSchema=function(e){var t,r=this.getParentSchemaKeys();return t=r.concat(e.key.split("/")),o({},e,{key:this.getCurrentSchemaKey(e),keys:t})},e.prototype.mergeUiSchemaToArray=function(e){if(!n.schemaKeysFactory.has(e.key))throw new Error(e.key+" did not found. do you forget to resolve schema first.");var t=n.schemaKeysFactory.get(e.key),r=n.schemaFieldFactory.get(t);return o({},r,e)},e.prototype.mergeUiSchema=function(){var e=this,t=this.uiSchemas.indexOf("*"),r=[],o=[];if(this.uiSchemas.lastIndexOf("*")!==t)throw new Error("uiSchema can only has one *.");if(t<0)return this.uiSchemas.slice(t+1).map(function(t){var o=e.initUiSchema(t.constructor===String?{key:t}:t);r.push(e.mergeUiSchemaToArray(o))}),r;if(this.uiSchemas.slice(0,t).forEach(function(t){var o=e.initUiSchema(t.constructor===String?{key:t}:t);r.push(e.mergeUiSchemaToArray(o))}),this.uiSchemas.slice(t+1).forEach(function(t){var r=e.initUiSchema(t.constructor===String?{key:t}:t);o.push(e.mergeUiSchemaToArray(r))}),"object"===this.curSchema.type&&this.curSchema.properties&&Object.keys(this.curSchema.properties).forEach(function(t){var a=e.initUiSchema({key:t});r.concat(o).filter(function(e){return e.key===a.key}).length||(a=e.mergeUiSchemaToArray(a),r.push(a))}),"array"===this.curSchema.type&&this.curSchema.items){var a=this.initUiSchema({key:c.ResolveLib.getDataKeys(this.curSchema.schemaPath).join("/")});r.concat(o).filter(function(e){return e.key===a.key}).length||(a=this.mergeUiSchemaToArray(a),r.push(a))}return r.concat(o)},e}();t.MergeLib=i},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.uiSchemaSchema={type:"array",items:{anyOf:[{type:"string",minLength:1},{additionalProperties:!0,type:"object",required:["key"],properties:{key:{type:"string"}}}]}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e};t.default=function(e,t,r){if(e.items){var n=new a.ResolveLib(r,e.items,[t,"items"].join("/")),c=a.ResolveLib.getDataKeys([t,"items"].join("/"));o(n.mergeSchema,{keys:c})}return e};var a=r(1);e.exports=t.default},function(e,t,r){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=r(9);Object.defineProperty(t,"array",{enumerable:!0,get:function(){return o(a).default}});var n=r(12);Object.defineProperty(t,"object",{enumerable:!0,get:function(){return o(n).default}});var c=r(11);Object.defineProperty(t,"none",{enumerable:!0,get:function(){return o(c).default}})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e};t.default=function(e,t,r){var c=(0,a.convertKeys)(e,r),i=n.ResolveLib.getDataKeys(t),s=n.ResolveLib.getSchemaId(t);return a.schemaFieldFactory.has(t)?c||e:(a.schemaFieldFactory.add(t,o({},c||e,{keys:i,schemaPath:t})),a.schemaKeysFactory.add([s].concat(i).join("/"),t),e)};var a=r(2),n=r(1);e.exports=t.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e};t.default=function(e,t,r){return e.properties&&Object.keys(e.properties).forEach(function(n){if(["properties","items"].indexOf(n)>=0)throw new Error(n+"\u4e3a\u4fdd\u7559\u5173\u952e\u5b57.");var c=new a.ResolveLib(r,e.properties[n],[t,"properties",n].join("/")),i=a.ResolveLib.getDataKeys([t,"properties",n].join("/"));o(c.mergeSchema,{keys:i})}),e};var a=r(1);e.exports=t.default}])});