!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports["fx-schema-form-core"]=t():e["fx-schema-form-core"]=t()}(this,function(){return function(e){function t(a){if(r[a])return r[a].exports;var o=r[a]={exports:{},id:a,loaded:!1};return e[a].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var r={};return t.m=e,t.c=r,t.p="/",t(0)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.schemaTypeFactory=t.schemaKeyWordFactory=t.schemaFieldFactory=t.schemaKeysFactory=t.BaseFactory=t.MergeLib=t.ResolveLib=void 0;var a=r(1);Object.defineProperty(t,"ResolveLib",{enumerable:!0,get:function(){return a.ResolveLib}});var o=r(7);Object.defineProperty(t,"MergeLib",{enumerable:!0,get:function(){return o.MergeLib}});var n=r(4),c=r(10),i=r(3),s=r(2);s.schemaKeyWordFactory.add("ref",n.ref),s.schemaKeyWordFactory.add("oneof",n.oneof),s.schemaTypeFactory.add("array",c.array),s.schemaTypeFactory.add("string",c.none),s.schemaTypeFactory.add("undefined",c.none),s.schemaTypeFactory.add("number",c.none),s.schemaTypeFactory.add("null",c.none),s.schemaTypeFactory.add("any",c.none),s.schemaTypeFactory.add("integer",c.none),s.schemaTypeFactory.add("boolean",c.none),s.schemaTypeFactory.add("object",c.object),t.BaseFactory=i.BaseFactory,t.schemaKeysFactory=s.schemaKeysFactory,t.schemaFieldFactory=s.schemaFieldFactory,t.schemaKeyWordFactory=s.schemaKeyWordFactory,t.schemaTypeFactory=s.schemaTypeFactory},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ResolveLib=void 0;var a=r(2),o=/#$/g,n=function(){function e(e,t,r){void 0===r&&(r=""),this.ajv=e,this.schema=t,this.$id=r,r||this.initSchema(e,t),this.compileSchema(t,r||t.$ref)}return e.prototype.initSchema=function(e,t){var r=t.$id;if(!r&&!t.$ref)throw new Error("id is required by fx-schema-form-core.");if(!e.validateSchema(t))throw e.errors;return r&&!e.getSchema(r)&&e.addSchema(t),t},e.prototype.compileSchema=function(e,t){if(e=a.schemaTypeFactory.get("undefined")(e,t||e.$id+"#",this.ajv),this.mergeSchema=e,e.type){if(e.type.constructor!==String)throw new Error("schema type["+e.type+"] can only be string.");var r=e.type.toString();a.schemaTypeFactory.has(r)&&(this.mergeSchema=a.schemaTypeFactory.get(r)(e,t||e.$id+"#",this.ajv))}},e.getDataKeys=function(e,t){void 0===t&&(t=!1);var r=e.split("/").map(function(e,r){return 0===r&&o.test(e)?(o.lastIndex=0,t?e.replace(o,""):null):"properties"===e?null:"items"===e?"-":e});return r.filter(function(e){return!!e})},e.getSchemaId=function(e){var t=e.split("/");if(!t.length)throw new Error(e+" not a valid schemaPath.");return t[0].replace(o,"")},e}();t.ResolveLib=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.convertKeys=t.schemaKeysFactory=t.schemaTypeFactory=t.schemaKeyWordFactory=t.schemaFieldFactory=void 0;var a=r(3),o=(t.schemaFieldFactory=new a.BaseFactory,t.schemaKeyWordFactory=new a.BaseFactory);t.schemaTypeFactory=new a.BaseFactory,t.schemaKeysFactory=new a.BaseFactory,t.convertKeys=function(e,t){return o.forEach(function(r,a){e=a(e,t)}),e}},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this.instances={},this.protectedInstances={}}return e.prototype.add=function(e,t,r){return void 0===r&&(r=!1),this.protectedInstances.hasOwnProperty(e)?console.error("name=\u3010"+e+"\u3011has locked!"):!r&&this.has(e)?console.error("\u3010"+e+"\u3011exist!"):(this.instances[e]=t,!0)},e.prototype.has=function(e){return this.instances.hasOwnProperty(e)},e.prototype.get=function(e){if(this.has(e))return this.instances[e];throw new Error("name=["+e+"]not exist")},e.prototype.lock=function(e){this.has(e)&&(this.protectedInstances[e]=!0)},e.prototype.unLock=function(e){this.has(e)&&delete this.protectedInstances[e]},e.prototype.forEach=function(e){if(e)for(var t in this.instances)if(this.instances.hasOwnProperty(t)){var r=this.instances[t];if(e(t,r)===!1)break}},e.prototype.clear=function(){this.instances={},this.protectedInstances={}},e}();t.BaseFactory=r},function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=r(6);Object.defineProperty(t,"ref",{enumerable:!0,get:function(){return a(o).default}});var n=r(5);Object.defineProperty(t,"oneof",{enumerable:!0,get:function(){return a(n).default}})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return e&&e.oneOf&&e.oneOf.constructor===Array&&(e.oneOf=e.oneOf.map(function(e){var r=new a.ResolveLib(t,e);return r.mergeSchema})),e};var a=r(1);e.exports=t.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e};t.default=function(e,t){if(e&&e.$ref){var r=t.getSchema(e.$ref);if(r&&r.schema){var n=r.schema;return n.$ref=e.$ref,a(n,{refKeys:o.ResolveLib.getDataKeys(e.$ref)}),n}throw new Error("${schema.$ref} not exist.")}return e};var o=r(1);e.exports=t.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MergeLib=void 0;var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e},o=r(8),n=r(2),c=r(1),i=function(){function e(e,t,r,a){if(this.ajv=e,this.schemaPath=t,this.parentKeys=r,this.uiSchemas=a,!e.validate(o.uiSchemaSchema,a))throw e.errors;var i=c.ResolveLib.getDataKeys(t,!0).join("/");if(!n.schemaKeysFactory.has(i))throw new Error(i+" not exist or "+i+" did not resolve yet.");this.curSchema=n.schemaFieldFactory.get(n.schemaKeysFactory.get(i)),this.mergeUiSchemaList=this.mergeUiSchema()}return e.prototype.initUiSchema=function(e){var t=c.ResolveLib.getSchemaId(this.schemaPath);return e.constructor===String?e?{key:[t,e].join("/")}:{key:t}:{key:[t,e.key].join("/")}},e.prototype.mergeUiSchemaToArray=function(e){if(!n.schemaKeysFactory.has(e.key))throw new Error(e.key+" did not found. do you forget to resolve schema first.");var t=n.schemaKeysFactory.get(e.key),r=n.schemaFieldFactory.get(t);return a({},r,e)},e.prototype.mergeUiSchema=function(){var e=this,t=this.uiSchemas.indexOf("*"),r=[],a=[];if(this.uiSchemas.lastIndexOf("*")!==t)throw new Error("uiSchema can only has one *.");if(t<0)return this.uiSchemas.slice(t+1).map(function(t){var a=e.initUiSchema(t);r.push(e.mergeUiSchemaToArray(a))}),r;if(this.uiSchemas.slice(0,t).forEach(function(t){var a=e.initUiSchema(t);r.push(e.mergeUiSchemaToArray(a))}),this.uiSchemas.slice(t+1).forEach(function(t){var r=e.initUiSchema(t);a.push(e.mergeUiSchemaToArray(r))}),"object"===this.curSchema.type&&this.curSchema.properties&&Object.keys(this.curSchema.properties).forEach(function(t){var o=e.initUiSchema(c.ResolveLib.getDataKeys(e.curSchema.schemaPath).concat([t]).join("/"));r.concat(a).filter(function(e){return e.key===o.key}).length||(o=e.mergeUiSchemaToArray(o),r.push(o))}),"array"===this.curSchema.type&&this.curSchema.items){var o=this.initUiSchema(c.ResolveLib.getDataKeys(this.curSchema.schemaPath).join("/")),n=this.initUiSchema(c.ResolveLib.getDataKeys(this.curSchema.schemaPath).concat(["-"]).join("/"));r.concat(a).filter(function(e){return e.key===o.key}).length||(o=this.mergeUiSchemaToArray(o),r.push(o)),r.concat(a).filter(function(e){return e.key===n.key}).length||(n=this.mergeUiSchemaToArray(n),r.push(n))}return r.concat(a)},e}();t.MergeLib=i},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.uiSchemaSchema={type:"array",items:{anyOf:[{type:"string",minLength:1},{additionalProperties:!0,type:"object",required:["key"],properties:{key:{type:"string"}}}]}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e};t.default=function(e,t,r){if(e.items){var n=new o.ResolveLib(r,e.items,[t,"items"].join("/")),c=o.ResolveLib.getDataKeys([t,"items"].join("/"));a(n.mergeSchema,{keys:c})}return e};var o=r(1);e.exports=t.default},function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=r(9);Object.defineProperty(t,"array",{enumerable:!0,get:function(){return a(o).default}});var n=r(12);Object.defineProperty(t,"object",{enumerable:!0,get:function(){return a(n).default}});var c=r(11);Object.defineProperty(t,"none",{enumerable:!0,get:function(){return a(c).default}})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e};t.default=function(e,t,r){var c=(0,o.convertKeys)(e,r),i=n.ResolveLib.getDataKeys(t),s=n.ResolveLib.getSchemaId(t);return o.schemaFieldFactory.has(t)?c||e:(o.schemaFieldFactory.add(t,a({},c||e,{keys:i,schemaPath:t})),o.schemaKeysFactory.add([s].concat(i).join("/"),t),e)};var o=r(2),n=r(1);e.exports=t.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e};t.default=function(e,t,r){return e.properties&&Object.keys(e.properties).forEach(function(n){if(["properties","items"].indexOf(n)>=0)throw new Error(n+"\u4e3a\u4fdd\u7559\u5173\u952e\u5b57.");var c=new o.ResolveLib(r,e.properties[n],[t,"properties",n].join("/")),i=o.ResolveLib.getDataKeys([t,"properties",n].join("/"));a(c.mergeSchema,{keys:i})}),e};var o=r(1);e.exports=t.default}])});